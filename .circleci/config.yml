version: 2.1

jobs:
  build:
    docker:
      - image: circleci/ruby:2.4
    working_directory: ~/code-reporting-tools
    steps:
      - checkout
      - run:
          name: Install prerequisites
          command: gem install codeinventory && gem install codeinventory-github
      - run:
          name: Collect repository metadata
          command: ~/code-reporting-tools/harvest.sh code.json
      - store_artifacts:
          path: ~/code-reporting-tools/code.json

workflows:
  version: 2
  harvest:
    jobs:
      - build
